<!DOCTYPE html>
<html lang="en" id="html">
	<meta charset="UTF-8">
	<title>Page Title</title>
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link rel="stylesheet" href="../css/style.css">
	<style>
	</style>
	<script>
	</script>
	<body id="body">
		<div id="info_holder" hidden>

		</div>
		<span id="cover"></span>
		<header>
			<img src="../img/logo.png">
			<div id="searcharea">
				<h4 id="categories">Categories</h4>
				<input id="searchbar" name="q" type="text" placeholder="Search the world!">
				<img id="search_btn" src="../img/search_black_24dp.svg">
			</div>
		</header>
		<nav id="nav-sort">
			<h3>Sort</h3>
			<ul id="options-sort">
				<li class="active">Relevance</li>
				<li>Newest first</li>
				<li>Oldest first</li>
				<li>A-Z</li>
				<li>Z-A</li>
				<li>Price (Ascending)</li>
				<li>Price (Descending</li>
			</ul>
		</nav>
		<main id="main-search">
			<span><img onclick="open_info(this)" src="../img/car.jpg"></span>
			<span><img src="../img/car.jpg"></span>
			<span><img src="../img/car.jpg"></span>
			<span><img src="../img/car.jpeg"></span>
			<span><img src="../img/car.jpg"></span>
			<span><img src="../img/car.jpeg"></span>
			<span><img src="../img/car.jpeg"></span>
			<span><img src="../img/car.jpg"></span>
			<span><img src="../img/car.jpg"></span>
			<span><img src="../img/car.jpg"></span>
			<span><img src="../img/car.jpeg"></span>
			<span><img src="../img/car.jpg"></span>
			<span><img src="../img/car.jpeg"></span>
			<span><img src="../img/car.jpg"></span>
			<span><img src="../img/car.jpeg"></span>
			<span><img src="../img/car.jpg"></span>
			<span><img src="../img/car.jpg"></span>
			<span><img src="../img/car.jpg"></span>
			<span><img src="../img/car.jpeg"></span>
			<span><img src="../img/car.jpg"></span>
		</main>
	</body>
	<script>
		function map(input, input_start, input_end, output_start, output_end) {
			return output_start + ((output_end - output_start) / (input_end - input_start)) * (input - input_start);
		}

		cover = document.getElementById("cover");
		searchbar = document.getElementById("searchbar");
		search_btn = document.getElementById("search_btn");
		options_sort = document.getElementById("options-sort");

		function search_href() {
			val = searchbar.value;
			cover.classList.remove("uncover_left");
			setTimeout(function() {
				window.location.href = "/search#q=" + val;
			}, 500) // this function will be executed 500ms later
		}

		searchbar.addEventListener("keypress", event => {
			if (event.key === 'Enter') {
				search_href();
			}
		});

		search_btn.addEventListener("click", event => {
			search_href();
		});

		window.onload = function(){
			cover.className = "";
			cover.classList.add("uncover_right");
		}
		var hashParams = window.location.hash.substr(1).split('&'); // substr(1) to remove the `#`
		for(var i = 0; i < hashParams.length; i++){ // iterate over values
			var p = hashParams[i].split('=');
			if (p[0] == "q") { // if we find the parameter "q", load that into the searchbar
				document.getElementById("searchbar").value = decodeURIComponent(p[1]);
				break; // we've found what we were looking for, exit the for loop
			}
		}
		
		for (var i = 0; i < options_sort.children.length; i++) {
			child = options_sort.children[i];
			child.addEventListener("click", event => {
				for (var i = 0; i < options_sort.children.length; i++) {
					child = options_sort.children[i];
					if (child != event.target)
						child.classList.remove("active");
				}
				event.target.classList.toggle("active");
				if (!event.target.classList.contains("active"))
					options_sort.children[0].classList.add("active");
			});
		}

		function freeze_scroll() {
			document.getElementsByTagName('main')[0].style.overflow = 'hidden';
		}
		function thaw_scroll() {
			document.getElementsByTagName('main')[0].style.overflow = ''
		}

		var info_open = false;

		function open_info(element) {
			if (info_open) {
				return;
			}
			info_open = true;
			freeze_scroll();

			/* Begin cloning and placement */
			var infoHolder = document.getElementById("info_holder");
			var rect = element.getBoundingClientRect();
			
			clone = element.cloneNode(true);
			clone.style.width 	 = element.offsetWidth  + "px";
			clone.style.height	 = element.offsetHeight + "px";
			clone.style.top 	 = rect.top + "px";
			clone.style.left	 = rect.left + "px";

			clone.dataset.start_top   = rect.top;
			clone.dataset.start_left  = rect.left;
			clone.dataset.start_width = element.offsetWidth;
			clone.dataset.start_height = element.offsetHeight;

			infoHolder.appendChild(clone);
			infoHolder.hidden = false;

			/* Zoom element */
			setTimeout(function(){
				target_top = 20;
				target_left = 20;
				target_bot = 20;
				target_right = 20;

				clone.style.top     = target_top + '%';
				clone.style.left    = target_left + '%';
				clone.style.width   = (100 - target_top - target_bot) + '%';
				clone.style.height  = (100 - target_left - target_right) + '%';
			}, 20);

		}

	</script>
</html>
